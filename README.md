# Phantom-ROV-Hypack-Data-Processing
These R scripts provide the means to process the various sensors on the Phantom from the Hypack and ASDL log files into a 1 Hz time series .CSV file.


**1_Hypack_Data_Parser.R**

This script reads in Hypack. RAW files and extracts all collected data readings, it builds a 1 Hz times series of the sensor data logged by Hypack during the survey, and converts position data from a projected coordinate reference system (UTM North Zones, 8 9 or 10) to an unprojected data set of latitude and longitude as decimal degrees. No interpolation of missing values is done at this stage.

The script will try to find depth and position data records for a user defined 'preferred' depth and position source from the Phantom ROV -- in practice, this is likely the more accurate depth of the CTD (rather than the vehicle's onboard sensor) and whatever transponder or responder was used during the survey that is being processed.


**2_ASDL_Data_Parser.R**

This script reads in the log files generated by Advanced Serial data logger. Various cleaning steps are completed on the log files, and daily/hourly log files are aggregated into one "Master" log file for each device that spans the duration of the entire survey/cruise. For all log files, timestamps are generated to match the standard R POSIX timestamp format of YYYY-MM-DD HH:MM:SS, and any duplicate values where the readings occur more frequently than 1 Hz are removed. Master files are generated as .CSV files, one per device/sensor.


**3_QAQC_Interpolation_Offset_and_Data_Smoothing**

This script contains functions to try fill in missing data from ROV sensors, as well as functions to smooth position data generated from the ROV's acoustic tracking system.  It integrates data from both Hypack .RAW files, CTD data exported as Excel files (.xlsx) and Advanced Serial Data Logger's (ASDL) log files. Where data records are missing from the Hypack .RAW file, and RBR files, backup copies of the missing data are sought from the ASDL log files and are used to fill in the missing data if possible. Linear interpolation is conducted for position data (latitude & longitude), as well as the data from the ROV's depth, altitude, ship heading and MiniZeus slant range to target. An offset for the mounting location of the GPS antenna on the survey vessel are then applied to the interpolated ROV position data.

A simple outlier analysis process is conducted on the data after the appropriate offsets have been applied. This function calculates the cross-track distance between the survey vessel and the interpolated position data from the ROV's beacon. On a second to second time scale, the distance between the ship and the ROV should not change substantially. All ROV positions that have a greater crossdistance than 1.5 times the interquartile range of the cross distance distribution are classified as outliers, and removed. Following which any ROV positions with a crossdistance value greater than the max distance set by the user are also removed. A second round of linear interpolation is used to fill in the gaps in the position data where outliers were removed.

Lastly, two seperate smoothing functions are applied to the ROV's position data: a running median function (https://stat.ethz.ch/R-manual/R-devel/library/stats/html/runmed.html) and a LOESS smoothing function (http://r-statistics.co/Loess-Regression-With-R.html). These two function both improve on the unsmoothed data set. In general, the LOESS smoother will provide a better (i.e. smoother) final output to the data set; however, in cases where the tracking was exceedingly poor, the running median smoothing function may provide a better output. Both smoothed data sets are provided as outputs from this script, to allow the end user to choose according to their needs. The user should check the generated transect maps saved in the Figures directory to select the best smoothing option for the survey.

At the end of this script, a .CSV file is written for each transect, at a 1 Hz interval.


**4_Generate_KML_and_Shapefiles.R**

This script loads in exports from the QAQC script and generates spatial files (in KML and shapefile formats) that represent the location of transects. Spatial lines are created for smoothed and unsmoothed position data. 